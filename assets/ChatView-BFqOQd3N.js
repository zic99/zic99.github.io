import{_ as K,r as D,c as fe,w as de,o as _e,a as q,b as O,d as n,F as me,e as ve,n as ne,f as we,g as re,h as se,i as be,j as ge,k as P,t as W,l as he,m as J,p as te,v as le,q as ue,s as xe,u as ke}from"./index-CJ-8knDk.js";function Se(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var ce={exports:{}},Ie=ce.exports,pe;function De(){return pe||(pe=1,function(p,U){(function(d,o){p.exports=o()})(Ie,function(){var d=1e3,o=6e4,w=36e5,k="millisecond",T="second",C="minute",x="hour",S="day",$="week",i="month",b="quarter",u="year",V="date",H="Invalid Date",L=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,r=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],e=c%100;return"["+c+(s[(e-20)%10]||s[e]||s[0])+"]"}},M=function(c,s,e){var a=String(c);return!a||a.length>=s?c:""+Array(s+1-a.length).join(e)+c},X={s:M,z:function(c){var s=-c.utcOffset(),e=Math.abs(s),a=Math.floor(e/60),t=e%60;return(s<=0?"+":"-")+M(a,2,"0")+":"+M(t,2,"0")},m:function c(s,e){if(s.date()<e.date())return-c(e,s);var a=12*(e.year()-s.year())+(e.month()-s.month()),t=s.clone().add(a,i),m=e-t<0,v=s.clone().add(a+(m?-1:1),i);return+(-(a+(e-t)/(m?t-v:v-t))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:i,y:u,w:$,d:S,D:V,h:x,m:C,s:T,ms:k,Q:b}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},R="en",l={};l[R]=g;var _="$isDayjsObject",f=function(c){return c instanceof B||!(!c||!c[_])},E=function c(s,e,a){var t;if(!s)return R;if(typeof s=="string"){var m=s.toLowerCase();l[m]&&(t=m),e&&(l[m]=e,t=m);var v=s.split("-");if(!t&&v.length>1)return c(v[0])}else{var I=s.name;l[I]=s,t=I}return!a&&t&&(R=t),t||!a&&R},y=function(c,s){if(f(c))return c.clone();var e=typeof s=="object"?s:{};return e.date=c,e.args=arguments,new B(e)},h=X;h.l=E,h.i=f,h.w=function(c,s){return y(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var B=function(){function c(e){this.$L=E(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[_]=!0}var s=c.prototype;return s.parse=function(e){this.$d=function(a){var t=a.date,m=a.utc;if(t===null)return new Date(NaN);if(h.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var v=t.match(L);if(v){var I=v[2]-1||0,j=(v[7]||"0").substring(0,3);return m?new Date(Date.UTC(v[1],I,v[3]||1,v[4]||0,v[5]||0,v[6]||0,j)):new Date(v[1],I,v[3]||1,v[4]||0,v[5]||0,v[6]||0,j)}}return new Date(t)}(e),this.init()},s.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},s.$utils=function(){return h},s.isValid=function(){return this.$d.toString()!==H},s.isSame=function(e,a){var t=y(e);return this.startOf(a)<=t&&t<=this.endOf(a)},s.isAfter=function(e,a){return y(e)<this.startOf(a)},s.isBefore=function(e,a){return this.endOf(a)<y(e)},s.$g=function(e,a,t){return h.u(e)?this[a]:this.set(t,e)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(e,a){var t=this,m=!!h.u(a)||a,v=h.p(e),I=function(Z,A){var F=h.w(t.$u?Date.UTC(t.$y,A,Z):new Date(t.$y,A,Z),t);return m?F:F.endOf(S)},j=function(Z,A){return h.w(t.toDate()[Z].apply(t.toDate("s"),(m?[0,0,0,0]:[23,59,59,999]).slice(A)),t)},z=this.$W,Y=this.$M,N=this.$D,ee="set"+(this.$u?"UTC":"");switch(v){case u:return m?I(1,0):I(31,11);case i:return m?I(1,Y):I(0,Y+1);case $:var Q=this.$locale().weekStart||0,ae=(z<Q?z+7:z)-Q;return I(m?N-ae:N+(6-ae),Y);case S:case V:return j(ee+"Hours",0);case x:return j(ee+"Minutes",1);case C:return j(ee+"Seconds",2);case T:return j(ee+"Milliseconds",3);default:return this.clone()}},s.endOf=function(e){return this.startOf(e,!1)},s.$set=function(e,a){var t,m=h.p(e),v="set"+(this.$u?"UTC":""),I=(t={},t[S]=v+"Date",t[V]=v+"Date",t[i]=v+"Month",t[u]=v+"FullYear",t[x]=v+"Hours",t[C]=v+"Minutes",t[T]=v+"Seconds",t[k]=v+"Milliseconds",t)[m],j=m===S?this.$D+(a-this.$W):a;if(m===i||m===u){var z=this.clone().set(V,1);z.$d[I](j),z.init(),this.$d=z.set(V,Math.min(this.$D,z.daysInMonth())).$d}else I&&this.$d[I](j);return this.init(),this},s.set=function(e,a){return this.clone().$set(e,a)},s.get=function(e){return this[h.p(e)]()},s.add=function(e,a){var t,m=this;e=Number(e);var v=h.p(a),I=function(Y){var N=y(m);return h.w(N.date(N.date()+Math.round(Y*e)),m)};if(v===i)return this.set(i,this.$M+e);if(v===u)return this.set(u,this.$y+e);if(v===S)return I(1);if(v===$)return I(7);var j=(t={},t[C]=o,t[x]=w,t[T]=d,t)[v]||1,z=this.$d.getTime()+e*j;return h.w(z,this)},s.subtract=function(e,a){return this.add(-1*e,a)},s.format=function(e){var a=this,t=this.$locale();if(!this.isValid())return t.invalidDate||H;var m=e||"YYYY-MM-DDTHH:mm:ssZ",v=h.z(this),I=this.$H,j=this.$m,z=this.$M,Y=t.weekdays,N=t.months,ee=t.meridiem,Q=function(A,F,oe,ie){return A&&(A[F]||A(a,m))||oe[F].slice(0,ie)},ae=function(A){return h.s(I%12||12,A,"0")},Z=ee||function(A,F,oe){var ie=A<12?"AM":"PM";return oe?ie.toLowerCase():ie};return m.replace(r,function(A,F){return F||function(oe){switch(oe){case"YY":return String(a.$y).slice(-2);case"YYYY":return h.s(a.$y,4,"0");case"M":return z+1;case"MM":return h.s(z+1,2,"0");case"MMM":return Q(t.monthsShort,z,N,3);case"MMMM":return Q(N,z);case"D":return a.$D;case"DD":return h.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return Q(t.weekdaysMin,a.$W,Y,2);case"ddd":return Q(t.weekdaysShort,a.$W,Y,3);case"dddd":return Y[a.$W];case"H":return String(I);case"HH":return h.s(I,2,"0");case"h":return ae(1);case"hh":return ae(2);case"a":return Z(I,j,!0);case"A":return Z(I,j,!1);case"m":return String(j);case"mm":return h.s(j,2,"0");case"s":return String(a.$s);case"ss":return h.s(a.$s,2,"0");case"SSS":return h.s(a.$ms,3,"0");case"Z":return v}return null}(A)||v.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(e,a,t){var m,v=this,I=h.p(a),j=y(e),z=(j.utcOffset()-this.utcOffset())*o,Y=this-j,N=function(){return h.m(v,j)};switch(I){case u:m=N()/12;break;case i:m=N();break;case b:m=N()/3;break;case $:m=(Y-z)/6048e5;break;case S:m=(Y-z)/864e5;break;case x:m=Y/w;break;case C:m=Y/o;break;case T:m=Y/d;break;default:m=Y}return t?m:h.a(m)},s.daysInMonth=function(){return this.endOf(i).$D},s.$locale=function(){return l[this.$L]},s.locale=function(e,a){if(!e)return this.$L;var t=this.clone(),m=E(e,a,!0);return m&&(t.$L=m),t},s.clone=function(){return h.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),G=B.prototype;return y.prototype=G,[["$ms",k],["$s",T],["$m",C],["$H",x],["$W",S],["$M",i],["$y",u],["$D",V]].forEach(function(c){G[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),y.extend=function(c,s){return c.$i||(c(s,B,y),c.$i=!0),y},y.locale=E,y.isDayjs=f,y.unix=function(c){return y(1e3*c)},y.en=l[R],y.Ls=l,y.p={},y})}(ce)),ce.exports}var Ce=De();const Te=Se(Ce),Me=10,He={__name:"VirtualList",props:{items:Array,containerHeight:{type:Number,default:600},estimatedItemHeight:{type:Number,default:80}},setup(p,{expose:U}){const d=p,o=D(null),w=D([]),k=D(0),T=D(0),C=D(0);D(0);const x=D(0);function S(H,L){if(H){const r=H.offsetHeight;r&&w.value[L]!==r&&(w.value[L]=r,i())}}function $(H){let L=0;for(let r=0;r<H;r++)L+=w.value[r]||d.estimatedItemHeight;return L}function i(){x.value=d.items.reduce((H,L,r)=>H+(w.value[r]||d.estimatedItemHeight),0)}function b(){let H=0,L=0,r=d.items.length;for(let M=0;M<d.items.length;M++){const X=w.value[M]||d.estimatedItemHeight;if(H+X>C.value){L=M;break}H+=X}let g=0;for(r=L;r<d.items.length&&g<d.containerHeight;)g+=w.value[r]||d.estimatedItemHeight,r++;k.value=Math.max(0,L-Me),T.value=Math.min(d.items.length,r+Me)}const u=fe(()=>d.items.slice(k.value,T.value));function V(H){C.value=H.target.scrollTop,b()}return de(()=>d.items,()=>{w.value=[],re(()=>{i(),b()})}),_e(()=>{i(),b()}),U({onScroll:V,updateVisibleRange:b}),(H,L)=>(O(),q("div",{class:"virtual-list",style:ne({height:p.containerHeight+"px",overflowY:"auto",position:"relative"}),onScroll:V,ref_key:"container",ref:o},[n("div",{style:ne({height:x.value+"px",position:"relative"})},[(O(!0),q(me,null,ve(u.value,(r,g)=>(O(),q("div",{key:r.id,ref_for:!0,ref:M=>S(M,k.value+g),style:ne({position:"absolute",width:"100%",top:$(k.value+g)+"px"})},[we(H.$slots,"default",{item:r},void 0)],4))),128))],4)],36))}},je=K(He,[["__scopeId","data-v-4b886e84"]]),ye="/assets/Image_1083578313650448-B45b7cD2.jpg",$e="/assets/Image_1083567666771598-HBN7voJc.jpg",qe="/assets/qq-D5TZtWP0.png",Oe="/assets/huohua-DTAHrNL7.png",Ve="/assets/wx-Bg3sda2J.png",Le={class:"chat-container"},Ee=["id"],Ue={key:0,class:"avatar-wrap"},ze={key:0,class:"icon"},Ye=["src"],Ae={key:1,class:"icon"},Ne=["src"],Be={class:"message-content"},We={key:0,class:"quoteMessage"},Pe={class:"quoteHeader"},Je=["onClick"],Fe=["onClick"],Re=["src"],Qe={key:1,class:"avatar-wrap"},Ze={__name:"ChatWindow",props:{virtualMessages:{type:Array,default:()=>[]},viewMode:{type:String,default:"self"}},emits:"jumpToMessageById",setup(p,{expose:U,emit:d}){const o=p;console.log(o.viewMode);const w=fe(()=>o.viewMode==="self"?$e:ye),k=fe(()=>o.viewMode==="self"?ye:$e);console.log(w.value,k.value);const T=D(null),C=()=>{T.value.updateVisibleRange()},x=i=>{if(i==="wx")return Ve;if(i==="qq")return qe;if(i==="huohua")return Oe},S=d,$=i=>{S("jumpToMessageById",i)};return U({updateVisibleRange:C}),(i,b)=>(O(),q("div",Le,[b[0]||(b[0]=n("div",{class:"chat-header"},[n("span",{class:"chat-title"},"i。")],-1)),se(je,{items:o.virtualMessages,"item-size":80,class:"scroller",ref_key:"virtualListRef",ref:T},{default:be(({item:u})=>[n("div",{id:`message-${u.id}`,class:ge(["message-row",p.viewMode==="self"?u.sender==="zic"?"right":"left":u.sender==="zic"?"left":"right"])},[p.viewMode==="self"&&u.sender==="xjj"||p.viewMode==="other"&&u.sender==="zic"?(O(),q("div",Ue,[n("div",{class:"avatar",style:ne({backgroundImage:`url(${w.value})`})},null,4)])):P("",!0),n("div",{class:ge(["bubble-wrap",p.viewMode==="self"?u.sender==="zic"?"right":"left":u.sender==="zic"?"left":"right"])},[n("div",{class:ge(["message-bubble",p.viewMode==="self"?u.sender==="zic"?"right":"left":u.sender==="zic"?"left":"right"])},[u.sender==="xjj"?(O(),q("div",ze,[n("img",{src:x(u.platform),alt:""},null,8,Ye)])):P("",!0),u.sender==="zic"?(O(),q("div",Ae,[n("img",{src:x(u.platform),alt:""},null,8,Ne)])):P("",!0),n("div",Be,[u.quoteMessage?(O(),q("div",We,[n("div",Pe,[n("span",null,W(u.quoteMessage.sender),1),n("span",{onClick:V=>$(u.quoteMessage.id)},W("⤒"),9,Je)]),n("div",null,W(u.quoteMessage.content||(u.quoteMessage.image?"图片":"")),1)])):P("",!0),n("span",null,W(u.content),1)]),u.image?(O(),q("div",{key:2,class:"message-image",onClick:V=>i.previewImage(u.image)},[n("img",{src:u.image,alt:""},null,8,Re)],8,Fe)):P("",!0)],2)],2),p.viewMode==="self"&&u.sender==="zic"||p.viewMode==="other"&&u.sender==="xjj"?(O(),q("div",Qe,[n("div",{class:"avatar",style:ne({backgroundImage:`url(${k.value})`})},null,4)])):P("",!0)],10,Ee)]),_:1},8,["items"]),b[1]||(b[1]=n("div",{class:"chat-input-bar"},[n("input",{class:"chat-input",type:"text",placeholder:"",disabled:""}),n("button",{class:"chat-send-btn",disabled:""},"发送")],-1))]))}},Ke=K(Ze,[["__scopeId","data-v-35a57a92"]]),Xe={class:"image-selector"},Ge={key:0,class:"modal"},et={class:"modal-content"},tt={class:"image-grid"},st=["onClick"],nt=["src","alt"],at={__name:"ImageSelector",emits:["imageSelected"],setup(p,{emit:U}){const d=D([]),o=D(!1),w=U,k=S=>{w("imageSelected",`${S}`),C()},T=()=>{o.value=!0,x()},C=()=>{o.value=!1},x=async()=>{const S=Object.assign({"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg":()=>he(()=>import("./038932be4b191e1d2da90dd4c073ba53-B2Vt_GOE.js"),[]),"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg":()=>he(()=>import("./9c8b9a649ba9b48a457a74768823b153-DBTUI_mK.js"),[])});console.log({imageModules:S}),d.value=Object.keys(S).map($=>$.replace("@/assets/images/",""))};return(S,$)=>(O(),q("div",Xe,[n("button",{onClick:T},"选择图片"),o.value?(O(),q("div",Ge,[n("div",et,[n("span",{class:"close",onClick:C},"×"),n("div",tt,[(O(!0),q(me,null,ve(d.value,i=>(O(),q("div",{key:i,class:"image-item",onClick:b=>k(i)},[n("img",{src:`${i}`,alt:i},null,8,nt)],8,st))),128))])])])):P("",!0)]))}},ot=K(at,[["__scopeId","data-v-cfaf4da0"]]),lt={class:"enter-message-container"},it={class:"radio-group"},rt={class:"handleMessage"},ut={key:0},ct={class:"messagePreview"},dt={__name:"EnterMessage",props:{handleMessage:{type:Object,default:()=>{}},viewMode:{type:Object,default:""}},emits:["addMessage","cancelHandle"],setup(p,{emit:U}){const d=p,o=D("self"),w=D(""),k=D(""),T=D(""),C=D(""),x=D("qq"),S=U,$=()=>{if(!w.value.trim())return;const r=C.value,g={sender:o.value,message:w.value,event:k.value,platform:x.value,timestamp:d.handleMessage.message.timestamp||new Date(r).getTime(),image:b.value,handleMessage:d.handleMessage};console.log({chatRecord:g}),w.value="",k.value="",S("addMessage",g),L()},i=r=>{r.keyCode===13&&!r.shiftKey?(r.preventDefault(),$()):r.keyCode===9&&(r.preventDefault(),o.value=o.value==="self"?"other":"self")},b=D(null),u=r=>{console.log({image:r});const g=`${T.value.split("T")[0]} ${C.value}`;console.log(o);const M={sender:o.value,message:w.value,event:k.value,platform:x.value,timestamp:d.handleMessage.message.timestamp||new Date(g).getTime(),image:r,handleMessage:d.handleMessage};console.log({chatRecord:M}),S("addMessage",M),L()},V={edit:"编辑",quote:"引用"},H=r=>V[r],L=()=>{S("cancelHandle")};return de(()=>d.handleMessage,r=>{if(console.log(r),!r.type)return;const g=r.message.sender;d.viewMode==="self"?g==="zic"?o.value="self":o.value="other":g==="zic"?o.value="other":o.value="self",r.type==="edit"&&(w.value=r.message.content)},{deep:!0}),(r,g)=>(O(),q("div",lt,[n("div",it,[n("div",null,[n("label",null,[J(n("input",{type:"radio",name:"sender",value:"self","onUpdate:modelValue":g[0]||(g[0]=M=>o.value=M)},null,512),[[le,o.value]]),g[8]||(g[8]=te(" 我方 "))]),n("label",null,[J(n("input",{type:"radio",name:"sender",value:"other","onUpdate:modelValue":g[1]||(g[1]=M=>o.value=M)},null,512),[[le,o.value]]),g[9]||(g[9]=te(" 对方 "))])]),n("div",null,[n("label",null,[J(n("input",{type:"radio",name:"platform",value:"qq","onUpdate:modelValue":g[2]||(g[2]=M=>x.value=M)},null,512),[[le,x.value]]),g[10]||(g[10]=te(" QQ "))]),n("label",null,[J(n("input",{type:"radio",name:"platform",value:"wx","onUpdate:modelValue":g[3]||(g[3]=M=>x.value=M)},null,512),[[le,x.value]]),g[11]||(g[11]=te(" 微信 "))]),n("label",null,[J(n("input",{type:"radio",name:"platform",value:"huohua","onUpdate:modelValue":g[4]||(g[4]=M=>x.value=M)},null,512),[[le,x.value]]),g[12]||(g[12]=te(" 火花 "))])]),J(n("input",{style:{outline:"0"},type:"text","onUpdate:modelValue":g[5]||(g[5]=M=>k.value=M),placeholder:"请输入事件..."},null,512),[[ue,k.value]]),J(n("input",{type:"text","onUpdate:modelValue":g[6]||(g[6]=M=>C.value=M),style:{width:"140px",outline:"0","margin-left":"10px"},placeholder:"时间"},null,512),[[ue,C.value]]),se(ot,{onImageSelected:u})]),n("div",rt,[n("span",{class:"cancelBtn",onClick:L},W("✖"),1),p.handleMessage.type&&p.handleMessage.message?(O(),q("span",ut,W(H(p.handleMessage.type))+" : ",1)):P("",!0),n("span",ct,W(p.handleMessage.message.content||(p.handleMessage.message.image?"图片":"")),1)]),J(n("textarea",{"onUpdate:modelValue":g[7]||(g[7]=M=>w.value=M),placeholder:"请输入消息...",onKeydown:i},null,544),[[ue,w.value]]),n("button",{onClick:$},"发送")]))}},gt=K(dt,[["__scopeId","data-v-e664223f"]]),ft={key:0,class:"image-preview"},mt={class:"preview-content"},vt=["src"],ht={__name:"ImagePreview",props:{imageUrl:String},emits:["close"],setup(p,{emit:U}){D(!1);const d=U,o=()=>{d("close")};return(w,k)=>p.imageUrl?(O(),q("div",ft,[n("div",{class:"overlay",onClick:o}),n("div",mt,[n("button",{style:{outline:"0","margin-bottom":"20px"},onClick:o},W("✖"),1),n("img",{src:p.imageUrl,alt:"Preview"},null,8,vt)])])):P("",!0)}},pt=K(ht,[["__scopeId","data-v-76550259"]]),Mt={__name:"ContextMenu",emits:["editMessage","deleteMessage"],setup(p,{emit:U}){const d=D({isShow:!1,position:{x:0,y:0},messageId:0}),o=($,i)=>{$.preventDefault();const b=$.target.closest(".chat");console.log(b.offsetTop);const u={x:$.clientX-b.offsetLeft,y:$.clientY-b.offsetTop};d.value={isShow:!0,position:u,messageId:i}},w=()=>{d.value={isShow:!1,position:{x:0,y:0},messageId:0}},k=U,T=$=>{switch($){case"edit":C();break;case"delete":x();break;case"quote":S()}w()},C=()=>{k("editMessage",d.messageId)},x=()=>{k("deleteMessage",d.messageId)},S=()=>{k("quoteMessage",d.messageId)};return document.addEventListener("contextmenu",$=>{const i=$.target.closest(".message-row");if(i){const b=i.closest(".message-row").id.split("-")[1];d.messageId=b,o($,b)}}),document.addEventListener("click",$=>{$.target.closest(".context-menu")||w()}),($,i)=>{var b,u;return d.value.isShow?(O(),q("div",{key:0,class:"context-menu",style:ne({top:`${(b=d.value.position)==null?void 0:b.y}px`,left:`${(u=d.value.position)==null?void 0:u.x}px`})},[n("ul",null,[n("li",{onClick:i[0]||(i[0]=V=>T("edit"))},"编辑"),n("li",{onClick:i[1]||(i[1]=V=>T("quote"))},"引用"),n("li",{onClick:i[2]||(i[2]=V=>T("delete"))},"删除")])],4)):P("",!0)}}},yt=K(Mt,[["__scopeId","data-v-3fa06248"]]),$t={class:"chat"},_t={class:"meaasgeManager"},wt={class:"search-results"},bt=["onClick"],xt={class:"result-content"},kt={__name:"ChatView",setup(p){const U=D("self"),d=D(null),o=D([]),w=l=>Te(l).format("YYYY-DD-MM HH:mm"),k=l=>{let _={self:"zic",other:"xjj"};return U.value==="self"||(_={self:"xjj",other:"zic"}),_[l]},T=l=>{var y;const _=document.querySelector(".virtual-list").children[0],f={id:o.value.length+1,content:l.message,timestamp:l.timestamp,sender:k(l.sender),event:l.event,platform:l.platform,image:l.image,offsetTop:_.style.height.replace("px","")};if((y=l.handleMessage)!=null&&y.type){if(console.log(l.handleMessage.type),l.handleMessage.type==="edit"){const h=o.value.findIndex(B=>B.id===l.handleMessage.message.id);f.id=l.handleMessage.message.id,f.offsetTop=l.handleMessage.message.offsetTop,l.handleMessage.message.quoteMessage&&(f.quoteMessage=l.handleMessage.message.quoteMessage),o.value.splice(h,1,f)}l.handleMessage.type==="quote"&&(f.quoteMessage=l.handleMessage.message,o.value.push(f))}else o.value.push(f);if(l.handleMessage.type==="edit"){const h=document.getElementById(`message-${f.id}`),B=h.offsetHeight,G=f.id;re(()=>{const s=h.offsetHeight-B;console.log({diffHeight:s}),console.log(l.handleMessage.message.id);const e=o.value.findIndex(a=>a.id==G);console.log({i:e}),o.value.forEach((a,t)=>{t>e&&(console.log(e),a.offsetTop=+a.offsetTop+s)})})}console.log(o);const E=document.querySelector(".scroller");E.scrollTop=E.scrollHeight},C=()=>{const l=document.createElement("input");l.type="file",l.accept="application/json",l.onchange=async _=>{const f=_.target.files[0];if(f){const E=await f.text(),y=JSON.parse(E);console.log(ke(y)),o.value=[...y]}},l.click()},x=()=>{const l=o.value;console.log(o.value);const _=JSON.stringify(l),f=new Blob([_],{type:"application/json"}),E=URL.createObjectURL(f),y=document.createElement("a");y.href=E,y.download="chatlog.json",y.click(),URL.revokeObjectURL(E)},S=()=>{re(()=>{console.log("触发");const l=document.querySelector(".scroller");l&&(console.log(d.value),d.value.updateVisibleRange(),setTimeout(()=>{l.scrollTop=l.scrollHeight},100))})};de(o,()=>{console.log("触发监听"),S()},{deep:!0});const $=document.querySelector(".scroller");$&&$.addEventListener("scroll",()=>{console.log("Scrolled! Recalculate visible messages.")});const i=D(""),b=D([]),u=()=>{if(i.value===""){b.value=[];return}const l=i.value.split(" ").filter(f=>f.trim()!==""),_=o.value.filter(f=>l.every(E=>new RegExp(E,"i").test(f.content)));b.value=_};de(i,u);const V=l=>{const{offsetTop:_}=o.value.find(E=>E.id==l),f=document.querySelector(".scroller");f&&f.scrollTo({top:_,behavior:"smooth"})},H=D(null),L=()=>{H.value=null},r=xe({type:"",message:{}}),g=l=>{console.log(l),console.log(o.value);const _=o.value.find(f=>f.id==l);r.message=_,r.type="edit"},M=l=>{const _=o.value.findIndex(y=>y.id==l),f=document.getElementById(`message-${l}`),E=f.offsetHeight;o.value.splice(_,1),re(()=>{const h=f.offsetHeight-E;o.value.forEach((B,G)=>{G>_&&(console.log(_),B.offsetTop=+B.offsetTop+h)})})},X=l=>{const _=o.value.find(f=>f.id==l);r.message=_,r.type="quote"},R=()=>{r.type="",r.message={}};return(l,_)=>(O(),q("div",$t,[se(Ke,{virtualMessages:o.value,viewMode:U.value,ref_key:"chatWindowRef",ref:d,onJumpToMessageById:V},null,8,["virtualMessages","viewMode"]),n("div",_t,[se(gt,{viewMode:U.value,onAddMessage:T,handleMessage:r,onCancelHandle:R},null,8,["viewMode","handleMessage"]),n("button",{onClick:C},"导入聊天记录"),n("button",{onClick:x},"导出聊天记录"),n("button",{onClick:_[0]||(_[0]=f=>U.value=U.value==="self"?"other":"self")},"切换视角")]),J(n("input",{class:"chat-search",type:"text",placeholder:"搜索聊天记录","onUpdate:modelValue":_[1]||(_[1]=f=>i.value=f),onInput:u},null,544),[[ue,i.value]]),n("div",wt,[(O(!0),q(me,null,ve(b.value,f=>(O(),q("div",{key:f.id,class:"search-result-item",onClick:E=>V(f.id)},[n("div",xt,[n("div",null,[n("span",null,W(f.sender),1),n("span",null,W(w(f.timestamp)),1)]),_[2]||(_[2]=te("edit ")),n("span",null,W(f.content),1)])],8,bt))),128))]),se(pt,{imageUrl:H.value,onClose:L},null,8,["imageUrl"]),se(yt,{messageId:l.messageId,onEditMessage:g,onDeleteMessage:M,onQuoteMessage:X},null,8,["messageId"])]))}},It=K(kt,[["__scopeId","data-v-28efb468"]]);export{It as default};
