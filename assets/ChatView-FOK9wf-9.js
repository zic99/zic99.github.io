import{g as ye,_ as X,r as I,c as fe,w as ce,o as $e,a as H,b as q,d as n,F as pe,e as he,n as ie,f as xe,h as re,i as se,j as _e,k as de,l as W,t as B,m as ge,p as Q,q as te,v as ae,s as ue,u as we,x as be}from"./index-PNqBiXWt.js";var me={exports:{}},ke=me.exports,ve;function ze(){return ve||(ve=1,function(k,V){(function(u,o){k.exports=o()})(ke,function(){var u=1e3,o=6e4,$=36e5,w="millisecond",C="second",D="minute",x="hour",_="day",y="week",m="month",v="quarter",z="year",d="date",S="Invalid Date",A=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(r){var s=["th","st","nd","rd"],e=r%100;return"["+r+(s[(e-20)%10]||s[e]||s[0])+"]"}},M=function(r,s,e){var a=String(r);return!a||a.length>=s?r:""+Array(s+1-a.length).join(e)+r},G={s:M,z:function(r){var s=-r.utcOffset(),e=Math.abs(s),a=Math.floor(e/60),t=e%60;return(s<=0?"+":"-")+M(a,2,"0")+":"+M(t,2,"0")},m:function r(s,e){if(s.date()<e.date())return-r(e,s);var a=12*(e.year()-s.year())+(e.month()-s.month()),t=s.clone().add(a,m),c=e-t<0,g=s.clone().add(a+(c?-1:1),m);return+(-(a+(e-t)/(c?t-g:g-t))||0)},a:function(r){return r<0?Math.ceil(r)||0:Math.floor(r)},p:function(r){return{M:m,y:z,w:y,d:_,D:d,h:x,m:D,s:C,ms:w,Q:v}[r]||String(r||"").toLowerCase().replace(/s$/,"")},u:function(r){return r===void 0}},R="en",P={};P[R]=l;var i="$isDayjsObject",T=function(r){return r instanceof N||!(!r||!r[i])},p=function r(s,e,a){var t;if(!s)return R;if(typeof s=="string"){var c=s.toLowerCase();P[c]&&(t=c),e&&(P[c]=e,t=c);var g=s.split("-");if(!t&&g.length>1)return r(g[0])}else{var b=s.name;P[b]=s,t=b}return!a&&t&&(R=t),t||!a&&R},j=function(r,s){if(T(r))return r.clone();var e=typeof s=="object"?s:{};return e.date=r,e.args=arguments,new N(e)},h=G;h.l=p,h.i=T,h.w=function(r,s){return j(r,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var N=function(){function r(e){this.$L=p(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[i]=!0}var s=r.prototype;return s.parse=function(e){this.$d=function(a){var t=a.date,c=a.utc;if(t===null)return new Date(NaN);if(h.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var g=t.match(A);if(g){var b=g[2]-1||0,O=(g[7]||"0").substring(0,3);return c?new Date(Date.UTC(g[1],b,g[3]||1,g[4]||0,g[5]||0,g[6]||0,O)):new Date(g[1],b,g[3]||1,g[4]||0,g[5]||0,g[6]||0,O)}}return new Date(t)}(e),this.init()},s.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},s.$utils=function(){return h},s.isValid=function(){return this.$d.toString()!==S},s.isSame=function(e,a){var t=j(e);return this.startOf(a)<=t&&t<=this.endOf(a)},s.isAfter=function(e,a){return j(e)<this.startOf(a)},s.isBefore=function(e,a){return this.endOf(a)<j(e)},s.$g=function(e,a,t){return h.u(e)?this[a]:this.set(t,e)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(e,a){var t=this,c=!!h.u(a)||a,g=h.p(e),b=function(K,U){var F=h.w(t.$u?Date.UTC(t.$y,U,K):new Date(t.$y,U,K),t);return c?F:F.endOf(_)},O=function(K,U){return h.w(t.toDate()[K].apply(t.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(U)),t)},L=this.$W,E=this.$M,Y=this.$D,ee="set"+(this.$u?"UTC":"");switch(g){case z:return c?b(1,0):b(31,11);case m:return c?b(1,E):b(0,E+1);case y:var Z=this.$locale().weekStart||0,ne=(L<Z?L+7:L)-Z;return b(c?Y-ne:Y+(6-ne),E);case _:case d:return O(ee+"Hours",0);case x:return O(ee+"Minutes",1);case D:return O(ee+"Seconds",2);case C:return O(ee+"Milliseconds",3);default:return this.clone()}},s.endOf=function(e){return this.startOf(e,!1)},s.$set=function(e,a){var t,c=h.p(e),g="set"+(this.$u?"UTC":""),b=(t={},t[_]=g+"Date",t[d]=g+"Date",t[m]=g+"Month",t[z]=g+"FullYear",t[x]=g+"Hours",t[D]=g+"Minutes",t[C]=g+"Seconds",t[w]=g+"Milliseconds",t)[c],O=c===_?this.$D+(a-this.$W):a;if(c===m||c===z){var L=this.clone().set(d,1);L.$d[b](O),L.init(),this.$d=L.set(d,Math.min(this.$D,L.daysInMonth())).$d}else b&&this.$d[b](O);return this.init(),this},s.set=function(e,a){return this.clone().$set(e,a)},s.get=function(e){return this[h.p(e)]()},s.add=function(e,a){var t,c=this;e=Number(e);var g=h.p(a),b=function(E){var Y=j(c);return h.w(Y.date(Y.date()+Math.round(E*e)),c)};if(g===m)return this.set(m,this.$M+e);if(g===z)return this.set(z,this.$y+e);if(g===_)return b(1);if(g===y)return b(7);var O=(t={},t[D]=o,t[x]=$,t[C]=u,t)[g]||1,L=this.$d.getTime()+e*O;return h.w(L,this)},s.subtract=function(e,a){return this.add(-1*e,a)},s.format=function(e){var a=this,t=this.$locale();if(!this.isValid())return t.invalidDate||S;var c=e||"YYYY-MM-DDTHH:mm:ssZ",g=h.z(this),b=this.$H,O=this.$m,L=this.$M,E=t.weekdays,Y=t.months,ee=t.meridiem,Z=function(U,F,oe,le){return U&&(U[F]||U(a,c))||oe[F].slice(0,le)},ne=function(U){return h.s(b%12||12,U,"0")},K=ee||function(U,F,oe){var le=U<12?"AM":"PM";return oe?le.toLowerCase():le};return c.replace(f,function(U,F){return F||function(oe){switch(oe){case"YY":return String(a.$y).slice(-2);case"YYYY":return h.s(a.$y,4,"0");case"M":return L+1;case"MM":return h.s(L+1,2,"0");case"MMM":return Z(t.monthsShort,L,Y,3);case"MMMM":return Z(Y,L);case"D":return a.$D;case"DD":return h.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return Z(t.weekdaysMin,a.$W,E,2);case"ddd":return Z(t.weekdaysShort,a.$W,E,3);case"dddd":return E[a.$W];case"H":return String(b);case"HH":return h.s(b,2,"0");case"h":return ne(1);case"hh":return ne(2);case"a":return K(b,O,!0);case"A":return K(b,O,!1);case"m":return String(O);case"mm":return h.s(O,2,"0");case"s":return String(a.$s);case"ss":return h.s(a.$s,2,"0");case"SSS":return h.s(a.$ms,3,"0");case"Z":return g}return null}(U)||g.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(e,a,t){var c,g=this,b=h.p(a),O=j(e),L=(O.utcOffset()-this.utcOffset())*o,E=this-O,Y=function(){return h.m(g,O)};switch(b){case z:c=Y()/12;break;case m:c=Y();break;case v:c=Y()/3;break;case y:c=(E-L)/6048e5;break;case _:c=(E-L)/864e5;break;case x:c=E/$;break;case D:c=E/o;break;case C:c=E/u;break;default:c=E}return t?c:h.a(c)},s.daysInMonth=function(){return this.endOf(m).$D},s.$locale=function(){return P[this.$L]},s.locale=function(e,a){if(!e)return this.$L;var t=this.clone(),c=p(e,a,!0);return c&&(t.$L=c),t},s.clone=function(){return h.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},r}(),J=N.prototype;return j.prototype=J,[["$ms",w],["$s",C],["$m",D],["$H",x],["$W",_],["$M",m],["$y",z],["$D",d]].forEach(function(r){J[r[1]]=function(s){return this.$g(s,r[0],r[1])}}),j.extend=function(r,s){return r.$i||(r(s,N,j),r.$i=!0),j},j.locale=p,j.isDayjs=T,j.unix=function(r){return j(1e3*r)},j.en=P[R],j.Ls=P,j.p={},j})}(me)),me.exports}var Ie=ze();const Se=ye(Ie),je=20,De={__name:"VirtualList",props:{items:Array,containerHeight:{type:Number,default:600},estimatedItemHeight:{type:Number,default:80}},setup(k,{expose:V}){const u=k,o=I(null),$=I([]),w=I(0),C=I(0),D=I(0);I(0);const x=I(0);function _(S,A){if(S){const f=S.offsetHeight;f&&$.value[A]!==f&&($.value[A]=f,m())}}function y(S){let A=0;for(let f=0;f<S;f++)A+=$.value[f]||u.estimatedItemHeight;return A}function m(){x.value=u.items.reduce((S,A,f)=>S+($.value[f]||u.estimatedItemHeight),0)}function v(){let S=0,A=0,f=u.items.length;for(let M=0;M<u.items.length;M++){const G=$.value[M]||u.estimatedItemHeight;if(S+G>D.value){A=M;break}S+=G}let l=0;for(f=A;f<u.items.length&&l<u.containerHeight;)l+=$.value[f]||u.estimatedItemHeight,f++;w.value=Math.max(0,A-je),C.value=Math.min(u.items.length,f+je)}const z=fe(()=>u.items.slice(w.value,C.value));function d(S){D.value=S.target.scrollTop,v()}return ce(()=>u.items,()=>{$.value=[],re(()=>{m(),v()})}),$e(()=>{m(),v()}),V({onScroll:d,updateVisibleRange:v}),(S,A)=>(q(),H("div",{class:"virtual-list",style:{height:"100%",overflowY:"auto",position:"relative"},onScroll:d,ref_key:"container",ref:o},[n("div",{style:ie({height:x.value+"px",position:"relative"})},[(q(!0),H(pe,null,he(z.value,(f,l)=>(q(),H("div",{key:f.id,ref_for:!0,ref:M=>_(M,w.value+l),style:ie({position:"absolute",width:"100%",top:y(w.value+l)+"px"})},[xe(S.$slots,"default",{item:f},void 0)],4))),128))],4)],544))}},Ce=X(De,[["__scopeId","data-v-94484858"]]),Me="/assets/Image_1083578313650448-B45b7cD2.jpg",Te="/assets/Image_1083567666771598-HBN7voJc.jpg",He="/assets/qq-D5TZtWP0.png",qe="/assets/huohua-DTAHrNL7.png",Oe="/assets/wx-Bg3sda2J.png",Ae={class:"chat-container"},Ve=["id"],Le={key:0,class:"avatar-wrap"},Ee={key:0,class:"icon"},Ue=["src"],Ye={key:1,class:"icon"},Ne=["src"],Be={class:"message-content"},We={key:0,class:"quoteMessage"},Pe={class:"quoteHeader"},Je=["onClick"],Qe=["onClick"],Fe=["src"],Re={key:1,class:"avatar-wrap"},Ze={__name:"ChatWindow",props:{virtualMessages:{type:Array,default:()=>[]},viewMode:{type:String,default:"self"}},emits:"jumpToMessageById",setup(k,{expose:V,emit:u}){const o=k;console.log(o.viewMode);const $=fe(()=>o.viewMode==="self"?Te:Me),w=fe(()=>o.viewMode==="self"?Me:Te);console.log($.value,w.value);const C=I(null),D=()=>{C.value.updateVisibleRange()},x=v=>{if(v==="wx")return Oe;if(v==="qq")return He;if(v==="huohua")return qe},_=u,y=v=>{_("jumpToMessageById",v)},m=v=>{_("previewImage",v)};return V({updateVisibleRange:D}),(v,z)=>(q(),H("div",Ae,[z[0]||(z[0]=n("div",{class:"chat-header"},[n("span",{class:"chat-title"},"i。")],-1)),se(Ce,{items:o.virtualMessages,"item-size":80,class:"scroller",ref_key:"virtualListRef",ref:C},{default:_e(({item:d})=>[n("div",{id:`message-${d.id}`,class:de(["message-row",k.viewMode==="self"?d.sender==="zic"?"right":"left":d.sender==="zic"?"left":"right"])},[k.viewMode==="self"&&d.sender==="xjj"||k.viewMode==="other"&&d.sender==="zic"?(q(),H("div",Le,[n("div",{class:"avatar",style:ie({backgroundImage:`url(${$.value})`})},null,4)])):W("",!0),n("div",{class:de(["bubble-wrap",k.viewMode==="self"?d.sender==="zic"?"right":"left":d.sender==="zic"?"left":"right"])},[n("div",{class:de(["message-bubble",k.viewMode==="self"?d.sender==="zic"?"right":"left":d.sender==="zic"?"left":"right"])},[d.sender==="xjj"?(q(),H("div",Ee,[n("img",{src:x(d.platform),alt:""},null,8,Ue)])):W("",!0),d.sender==="zic"?(q(),H("div",Ye,[n("img",{src:x(d.platform),alt:""},null,8,Ne)])):W("",!0),n("div",Be,[d.quoteMessage?(q(),H("div",We,[n("div",Pe,[n("span",null,B(d.quoteMessage.sender),1),n("span",{onClick:S=>y(d.quoteMessage.id)},B("⤒"),9,Je)]),n("div",null,B(d.quoteMessage.content||(d.quoteMessage.image?"图片":"")),1)])):W("",!0),n("span",null,B(d.content),1)]),d.image?(q(),H("div",{key:2,class:"message-image",onClick:S=>m(d.image)},[n("img",{src:d.image,alt:""},null,8,Fe)],8,Qe)):W("",!0)],2)],2),k.viewMode==="self"&&d.sender==="zic"||k.viewMode==="other"&&d.sender==="xjj"?(q(),H("div",Re,[n("div",{class:"avatar",style:ie({backgroundImage:`url(${w.value})`})},null,4)])):W("",!0)],10,Ve)]),_:1},8,["items"]),z[1]||(z[1]=n("div",{class:"chat-input-bar"},[n("input",{class:"chat-input",type:"text",placeholder:"",disabled:""}),n("button",{class:"chat-send-btn",disabled:""},"发送")],-1))]))}},Ke=X(Ze,[["__scopeId","data-v-b48dfc3d"]]),Xe={class:"image-selector"},Ge={key:0,class:"modal"},et={class:"modal-content"},tt={class:"image-grid"},st=["onClick"],nt=["src","alt"],ot={__name:"ImageSelector",emits:["imageSelected"],setup(k,{emit:V}){const u=I([]),o=I(!1),$=V,w=_=>{$("imageSelected",`${_}`),D()},C=()=>{o.value=!0,x()},D=()=>{o.value=!1},x=async()=>{const _=Object.assign({"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg":()=>ge(()=>import("./038932be4b191e1d2da90dd4c073ba53-B2Vt_GOE.js"),[]),"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg":()=>ge(()=>import("./9c8b9a649ba9b48a457a74768823b153-DBTUI_mK.js"),[])});console.log({imageModules:_}),u.value=Object.keys(_).map(y=>y.replace("@/assets/images/",""))};return(_,y)=>(q(),H("div",Xe,[n("button",{onClick:C},"选择图片"),o.value?(q(),H("div",Ge,[n("div",et,[n("span",{class:"close",onClick:D},"×"),n("div",tt,[(q(!0),H(pe,null,he(u.value,m=>(q(),H("div",{key:m,class:"image-item",onClick:v=>w(m)},[n("img",{src:`${m}`,alt:m},null,8,nt)],8,st))),128))])])])):W("",!0)]))}},at=X(ot,[["__scopeId","data-v-cfaf4da0"]]),it={class:"enter-message-container"},lt={class:"radio-group"},rt={class:"handleMessage"},ut={key:0},mt={class:"messagePreview"},ct={__name:"EnterMessage",props:{handleMessage:{type:Object,default:()=>{}},viewMode:{type:Object,default:""}},emits:["addMessage","cancelHandle"],setup(k,{emit:V}){const u=k,o=I("self"),$=I(""),w=I(""),C=I(""),D=I(""),x=I("qq"),_=V,y=()=>{if(!$.value.trim())return;const f=D.value,l={sender:o.value,message:$.value,event:w.value,platform:x.value,timestamp:u.handleMessage.message.timestamp||new Date(f).getTime(),image:v.value,handleMessage:u.handleMessage};console.log({chatRecord:l}),$.value="",w.value="",_("addMessage",l),A()},m=f=>{f.keyCode===13&&!f.shiftKey?(f.preventDefault(),y()):f.keyCode===9&&(f.preventDefault(),o.value=o.value==="self"?"other":"self")},v=I(null),z=f=>{console.log({image:f});const l=`${C.value.split("T")[0]} ${D.value}`;console.log(o);const M={sender:o.value,message:$.value,event:w.value,platform:x.value,timestamp:u.handleMessage.message.timestamp||new Date(l).getTime(),image:f,handleMessage:u.handleMessage};console.log({chatRecord:M}),_("addMessage",M),A()},d={edit:"编辑",quote:"引用"},S=f=>d[f],A=()=>{_("cancelHandle")};return ce(()=>u.handleMessage,f=>{if(console.log(f),!f.type)return;const l=f.message.sender;u.viewMode==="self"?l==="zic"?o.value="self":o.value="other":l==="zic"?o.value="other":o.value="self",f.type==="edit"&&($.value=f.message.content)},{deep:!0}),(f,l)=>(q(),H("div",it,[n("div",lt,[n("div",null,[n("label",null,[Q(n("input",{type:"radio",name:"sender",value:"self","onUpdate:modelValue":l[0]||(l[0]=M=>o.value=M)},null,512),[[ae,o.value]]),l[8]||(l[8]=te(" 我方 "))]),n("label",null,[Q(n("input",{type:"radio",name:"sender",value:"other","onUpdate:modelValue":l[1]||(l[1]=M=>o.value=M)},null,512),[[ae,o.value]]),l[9]||(l[9]=te(" 对方 "))])]),n("div",null,[n("label",null,[Q(n("input",{type:"radio",name:"platform",value:"qq","onUpdate:modelValue":l[2]||(l[2]=M=>x.value=M)},null,512),[[ae,x.value]]),l[10]||(l[10]=te(" QQ "))]),n("label",null,[Q(n("input",{type:"radio",name:"platform",value:"wx","onUpdate:modelValue":l[3]||(l[3]=M=>x.value=M)},null,512),[[ae,x.value]]),l[11]||(l[11]=te(" 微信 "))]),n("label",null,[Q(n("input",{type:"radio",name:"platform",value:"huohua","onUpdate:modelValue":l[4]||(l[4]=M=>x.value=M)},null,512),[[ae,x.value]]),l[12]||(l[12]=te(" 火花 "))])]),Q(n("input",{style:{outline:"0"},type:"text","onUpdate:modelValue":l[5]||(l[5]=M=>w.value=M),placeholder:"请输入事件..."},null,512),[[ue,w.value]]),Q(n("input",{type:"text","onUpdate:modelValue":l[6]||(l[6]=M=>D.value=M),style:{width:"140px",outline:"0","margin-left":"10px"},placeholder:"时间"},null,512),[[ue,D.value]]),se(at,{onImageSelected:z})]),n("div",rt,[n("span",{class:"cancelBtn",onClick:A},B("✖"),1),k.handleMessage.type&&k.handleMessage.message?(q(),H("span",ut,B(S(k.handleMessage.type))+" : ",1)):W("",!0),n("span",mt,B(k.handleMessage.message.content||(k.handleMessage.message.image?"图片":"")),1)]),Q(n("textarea",{"onUpdate:modelValue":l[7]||(l[7]=M=>$.value=M),placeholder:"请输入消息...",onKeydown:m},null,544),[[ue,$.value]]),n("button",{onClick:y},"发送")]))}},dt=X(ct,[["__scopeId","data-v-e664223f"]]),ft={key:0,class:"image-preview"},pt={class:"preview-content"},ht=["src"],gt={__name:"ImagePreview",props:{imageUrl:String},emits:["close"],setup(k,{emit:V}){I(!1);const u=V,o=()=>{u("close")};return($,w)=>k.imageUrl?(q(),H("div",ft,[n("div",{class:"overlay",onClick:o}),n("div",pt,[n("button",{style:{outline:"0","margin-bottom":"20px"},onClick:o},B("✖"),1),n("img",{src:k.imageUrl,alt:"Preview"},null,8,ht)])])):W("",!0)}},vt=X(gt,[["__scopeId","data-v-76550259"]]),jt={__name:"ContextMenu",emits:["editMessage","deleteMessage"],setup(k,{emit:V}){const u=I({isShow:!1,position:{x:0,y:0},messageId:0}),o=(y,m)=>{y.preventDefault();const v=y.target.closest(".chat");console.log(v.offsetTop);const z={x:y.clientX-v.offsetLeft,y:y.clientY-v.offsetTop};u.value={isShow:!0,position:z,messageId:m}},$=()=>{u.value={isShow:!1,position:{x:0,y:0},messageId:0}},w=V,C=y=>{switch(y){case"edit":D();break;case"delete":x();break;case"quote":_()}$()},D=()=>{w("editMessage",u.messageId)},x=()=>{w("deleteMessage",u.messageId)},_=()=>{w("quoteMessage",u.messageId)};return document.addEventListener("contextmenu",y=>{const m=y.target.closest(".message-row");if(m){const v=m.closest(".message-row").id.split("-")[1];u.messageId=v,o(y,v)}}),document.addEventListener("click",y=>{y.target.closest(".context-menu")||$()}),(y,m)=>{var v,z;return u.value.isShow?(q(),H("div",{key:0,class:"context-menu",style:ie({top:`${(v=u.value.position)==null?void 0:v.y}px`,left:`${(z=u.value.position)==null?void 0:z.x}px`})},[n("ul",null,[n("li",{onClick:m[0]||(m[0]=d=>C("edit"))},"编辑"),n("li",{onClick:m[1]||(m[1]=d=>C("quote"))},"引用"),n("li",{onClick:m[2]||(m[2]=d=>C("delete"))},"删除")])],4)):W("",!0)}}},Mt=X(jt,[["__scopeId","data-v-3fa06248"]]),Tt=JSON.parse('[{"id":1,"content":"你头像更可爱","timestamp":1742396160000,"sender":"xjj","event":"hello","platform":"huohua","image":null,"offsetTop":"0"},{"id":2,"content":"伊地知虹夏，孤独摇滚里的，你看过嘛","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"56"},{"id":3,"content":"没有诶","timestamp":1742396160000,"sender":"xjj","event":"","platform":"qq","image":null,"offsetTop":"136"},{"id":4,"content":"今天刚玩 我试试这个","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":192},{"id":5,"content":"哈哈哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":248},{"id":6,"content":"Q：咳嗽不小心把口香糖吐到前面人头上...\\nA：告诉TA并道歉","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":304},{"id":7,"content":"A：告诉TA并道歉","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":408},{"id":8,"content":"Q：相信一见钟情还是日久生情？\\nA：日久生情","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":464},{"id":9,"content":"Q：宁愿被拒绝也要表达爱意，还是永远藏在心里不表白？\\nA：宁愿被拒绝也要表达爱意","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":544},{"id":10,"content":"A：日久生情","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":648},{"id":11,"content":"这个好纠结","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":704},{"id":12,"content":"A：宁愿被拒绝也要表达爱意","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":760},{"id":13,"content":"Q：失眠一星期还是一星期睡不醒？\\nA：一星期睡不醒","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":816},{"id":14,"content":"哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":896},{"id":15,"content":"A：一星期睡不醒","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":952},{"id":16,"content":"哈哈哈哈哈哈哈哈哈哈牛啊","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1008},{"id":17,"content":"我也是，但最后，都会忍不住","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1064},{"id":18,"content":"而且很容易触发人生三大错觉之一，她喜欢我","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1120},{"id":19,"content":"哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1200},{"id":20,"content":"也是哦","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1256},{"id":21,"content":"而且说了说不定就有结局呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1312},{"id":22,"content":"😭","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1368},{"id":23,"content":"都是错觉","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1424},{"id":24,"content":"说了一定有结局，指朋友也做不了","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1480},{"id":25,"content":"看来你被伤过","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1536},{"id":26,"content":"很早了，过去了，我现在强得可怕","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1592},{"id":27,"content":"哇","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1648},{"id":28,"content":"哈哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1704},{"id":29,"content":"多强","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1760},{"id":30,"content":"现在见到谁都不会喜欢了","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1816},{"id":31,"content":"😇","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1872},{"id":32,"content":"哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1928},{"id":33,"content":"那的确挺强","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1984},{"id":34,"content":"那你为什么下这个软件","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2040},{"id":35,"content":"今天 听朋友说的","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2096},{"id":36,"content":"好吧嘿嘿","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2152},{"id":37,"content":"","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg","offsetTop":2208},{"id":38,"content":"你有点可爱，今年多大啦","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2506},{"id":39,"content":"可以问吗","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2562},{"id":40,"content":"21","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2618},{"id":41,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2674},{"id":42,"content":"","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg","offsetTop":2730},{"id":43,"content":"24","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3028},{"id":44,"content":"比你大点点","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3084},{"id":45,"content":"对嘿嘿","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3140},{"id":46,"content":"大三？","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3196},{"id":47,"content":"对!","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3252},{"id":48,"content":"真好啊，我已经是社畜了😇","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3308},{"id":49,"content":"哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3364},{"id":50,"content":"社畜也挺好啊","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3420},{"id":51,"content":"你在哪上学呢","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3476},{"id":52,"content":"山东","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3532},{"id":53,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3588},{"id":54,"content":"我山西运城的，在西安上班","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3644},{"id":55,"content":"之前在太原读的书","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3700},{"id":56,"content":"哦哦","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3756},{"id":57,"content":"明天有课吗","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3812},{"id":58,"content":"早八","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3868},{"id":59,"content":"🤣","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3924},{"id":60,"content":"平时玩什么","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3980},{"id":61,"content":"玩王者","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4036},{"id":62,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4092},{"id":63,"content":"周末和朋友玩英雄联盟，周内自己找点单机玩","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4148},{"id":64,"content":"哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4228},{"id":65,"content":"你不会是j人吧","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4284},{"id":66,"content":"jp的j哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4340},{"id":67,"content":"j人是什么，第一次听说","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4396},{"id":68,"content":"emmmm 查了下 主观上j人 客观上不是","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4452},{"id":69,"content":"哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4532},{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4588},{"id":71,"content":"就是对自己的一天很有规划","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4668},{"id":72,"content":"那你是p人","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4724,"quoteMessage":{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"4588"}},{"id":73,"content":"但现实遇到问题要解决的时候会计划好","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4852},{"id":74,"content":"那感觉还是p人","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4932},{"id":75,"content":"因为计划好了也会拖延","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5044,"quoteMessage":{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4588}},{"id":76,"content":"p人的p是procrastination的p","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5544},{"id":77,"content":"这个就是我的盲区了哈哈哈哈哈哈哈哈哈哈","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5600},{"id":78,"content":"拖延的意思","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5680},{"id":79,"content":"哦哦","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5736},{"id":80,"content":"我反正也是p人","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5792},{"id":81,"content":"mbti以前不都是说i人和e人的吗","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5848},{"id":82,"content":"哈哈哈哈哈哈哈哈","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5904},{"id":83,"content":"那你是i还是e","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5960},{"id":84,"content":"网上e，现实i","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6016},{"id":85,"content":"火花炮弹X1","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6072},{"id":86,"content":"Q:相信人性本善还是人性本恶\\nA：人性本恶","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6128},{"id":87,"content":"A:人性本恶","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"6424"},{"id":88,"content":"这个是我思考了好久的答案","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"6480"},{"id":89,"content":"到目前为止完全默契诶","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"6536"},{"id":90,"content":"","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg","offsetTop":"6592"},{"id":91,"content":"右边还真是我","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"7193"},{"id":92,"content":"我左边哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7249"},{"id":93,"content":"原来是这样 8个字母代表四组","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"7305"},{"id":94,"content":"你晚上几点睡觉呢","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"7361"},{"id":95,"content":"我不知道嘿嘿","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7417"},{"id":96,"content":"困了就睡","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7473},{"id":97,"content":"你呢","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7529"},{"id":98,"content":"你没测过mbti吗","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7585"},{"id":99,"content":"测过，不过以前只听说i/e人，所以只记得第一位是i了","timestamp":1742398740000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"7641"},{"id":100,"content":"哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7721"},{"id":101,"content":"我猜你是","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7777"},{"id":102,"content":"infp","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":"7777"}]'),yt={class:"chat"},$t={key:0},xt={class:"meaasgeManager"},_t={class:"search-results"},wt=["onClick"],bt={class:"result-content"},kt={__name:"ChatView",setup(k){const V=I("self"),u=I(null),o=I([]);o.value=[...Tt];const $=i=>Se(i).format("YYYY-DD-MM HH:mm"),w=i=>{let T={self:"zic",other:"xjj"};return V.value==="self"||(T={self:"xjj",other:"zic"}),T[i]},C=i=>{var h;const T=document.querySelector(".virtual-list").children[0],p={id:o.value.length+1,content:i.message,timestamp:i.timestamp,sender:w(i.sender),event:i.event,platform:i.platform,image:i.image,offsetTop:T.style.height.replace("px","")};if((h=i.handleMessage)!=null&&h.type){if(console.log(i.handleMessage.type),i.handleMessage.type==="edit"){const N=o.value.findIndex(J=>J.id===i.handleMessage.message.id);p.id=i.handleMessage.message.id,p.offsetTop=i.handleMessage.message.offsetTop,i.handleMessage.message.quoteMessage&&(p.quoteMessage=i.handleMessage.message.quoteMessage),o.value.splice(N,1,p)}i.handleMessage.type==="quote"&&(p.quoteMessage=i.handleMessage.message,o.value.push(p))}else o.value.push(p);if(i.handleMessage.type==="edit"){const N=document.getElementById(`message-${p.id}`),J=N.offsetHeight,r=p.id;re(()=>{const e=N.offsetHeight-J;console.log({diffHeight:e}),console.log(i.handleMessage.message.id);const a=o.value.findIndex(t=>t.id==r);console.log({i:a}),o.value.forEach((t,c)=>{c>a&&(console.log(a),t.offsetTop=+t.offsetTop+e)})})}console.log(o);const j=document.querySelector(".scroller");j.scrollTop=j.scrollHeight},D=()=>{const i=document.createElement("input");i.type="file",i.accept="application/json",i.onchange=async T=>{const p=T.target.files[0];if(p){const j=await p.text(),h=JSON.parse(j);console.log(be(h)),o.value=[...h]}},i.click()},x=()=>{const i=o.value;console.log(o.value);const T=JSON.stringify(i),p=new Blob([T],{type:"application/json"}),j=URL.createObjectURL(p),h=document.createElement("a");h.href=j,h.download="chatlog.json",h.click(),URL.revokeObjectURL(j)},_=()=>{re(()=>{console.log("触发");const i=document.querySelector(".scroller");i&&(console.log(u.value),u.value.updateVisibleRange(),setTimeout(()=>{i.scrollTop=i.scrollHeight},100))})};ce(o,()=>{console.log("触发监听"),_()},{deep:!0});const y=document.querySelector(".scroller");y&&y.addEventListener("scroll",()=>{console.log("Scrolled! Recalculate visible messages.")});const m=I(""),v=I([]),z=()=>{if(m.value===""){v.value=[];return}const i=m.value.split(" ").filter(p=>p.trim()!==""),T=o.value.filter(p=>i.every(j=>new RegExp(j,"i").test(p.content)));v.value=T};ce(m,z);const d=i=>{const{offsetTop:T}=o.value.find(j=>j.id==i),p=document.querySelector(".scroller");p&&p.scrollTo({top:T,behavior:"smooth"})},S=I(null),A=i=>{S.value=i},f=()=>{S.value=null},l=we({type:"",message:{}}),M=i=>{console.log(i),console.log(o.value);const T=o.value.find(p=>p.id==i);l.message=T,l.type="edit"},G=i=>{const T=o.value.findIndex(h=>h.id==i),p=document.getElementById(`message-${i}`),j=p.offsetHeight;o.value.splice(T,1),re(()=>{const N=p.offsetHeight-j;o.value.forEach((J,r)=>{r>T&&(console.log(T),J.offsetTop=+J.offsetTop+N)})})},R=i=>{const T=o.value.find(p=>p.id==i);l.message=T,l.type="quote"},P=()=>{l.type="",l.message={}};return(i,T)=>(q(),H("div",yt,[se(Ke,{virtualMessages:o.value,onPreviewImage:A,viewMode:V.value,ref_key:"chatWindowRef",ref:u,onJumpToMessageById:d},null,8,["virtualMessages","viewMode"]),(q(),H("div",$t,[n("div",xt,[se(dt,{viewMode:V.value,onAddMessage:C,handleMessage:l,onCancelHandle:P},null,8,["viewMode","handleMessage"]),n("button",{onClick:D},"导入聊天记录"),n("button",{onClick:x},"导出聊天记录"),n("button",{onClick:T[0]||(T[0]=p=>V.value=V.value==="self"?"other":"self")},"切换视角")]),Q(n("input",{class:"chat-search",type:"text",placeholder:"搜索聊天记录","onUpdate:modelValue":T[1]||(T[1]=p=>m.value=p),onInput:z},null,544),[[ue,m.value]]),n("div",_t,[(q(!0),H(pe,null,he(v.value,p=>(q(),H("div",{key:p.id,class:"search-result-item",onClick:j=>d(p.id)},[n("div",bt,[n("div",null,[n("span",null,B(p.sender),1),n("span",null,B($(p.timestamp)),1)]),T[2]||(T[2]=te("edit ")),n("span",null,B(p.content),1)])],8,wt))),128))]),se(Mt,{messageId:i.messageId,onEditMessage:M,onDeleteMessage:G,onQuoteMessage:R},null,8,["messageId"])])),se(vt,{imageUrl:S.value,onClose:f},null,8,["imageUrl"])]))}},It=X(kt,[["__scopeId","data-v-45b20cab"]]);export{It as default};
