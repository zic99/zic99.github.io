import{g as xe,_ as K,r as w,c as fe,w as ce,o as _e,a as q,b as H,d as n,F as pe,e as he,n as ae,f as be,h as re,i as te,j as we,k as de,l as N,t as R,m as ge,p as P,q as ee,v as oe,s as ue,u as ke,x as Ie}from"./index-wiYLxVdp.js";var me={exports:{}},ze=me.exports,ve;function Se(){return ve||(ve=1,function(k,V){(function(u,g){k.exports=g()})(ze,function(){var u=1e3,g=6e4,r=36e5,_="millisecond",D="second",I="minute",x="hour",z="day",M="week",v="month",y="quarter",T="year",C="date",m="Invalid Date",S=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(l){var s=["th","st","nd","rd"],e=l%100;return"["+l+(s[(e-20)%10]||s[e]||s[0])+"]"}},j=function(l,s,e){var a=String(l);return!a||a.length>=s?l:""+Array(s+1-a.length).join(e)+l},X={s:j,z:function(l){var s=-l.utcOffset(),e=Math.abs(s),a=Math.floor(e/60),t=e%60;return(s<=0?"+":"-")+j(a,2,"0")+":"+j(t,2,"0")},m:function l(s,e){if(s.date()<e.date())return-l(e,s);var a=12*(e.year()-s.year())+(e.month()-s.month()),t=s.clone().add(a,v),c=e-t<0,p=s.clone().add(a+(c?-1:1),v);return+(-(a+(e-t)/(c?t-p:p-t))||0)},a:function(l){return l<0?Math.ceil(l)||0:Math.floor(l)},p:function(l){return{M:v,y:T,w:M,d:z,D:C,h:x,m:I,s:D,ms:_,Q:y}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(l){return l===void 0}},Q="en",B={};B[Q]=d;var ie="$isDayjsObject",i=function(l){return l instanceof L||!(!l||!l[ie])},$=function l(s,e,a){var t;if(!s)return Q;if(typeof s=="string"){var c=s.toLowerCase();B[c]&&(t=c),e&&(B[c]=e,t=c);var p=s.split("-");if(!t&&p.length>1)return l(p[0])}else{var b=s.name;B[b]=s,t=b}return!a&&t&&(Q=t),t||!a&&Q},o=function(l,s){if(i(l))return l.clone();var e=typeof s=="object"?s:{};return e.date=l,e.args=arguments,new L(e)},f=X;f.l=$,f.i=i,f.w=function(l,s){return o(l,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var L=function(){function l(e){this.$L=$(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[ie]=!0}var s=l.prototype;return s.parse=function(e){this.$d=function(a){var t=a.date,c=a.utc;if(t===null)return new Date(NaN);if(f.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var p=t.match(S);if(p){var b=p[2]-1||0,O=(p[7]||"0").substring(0,3);return c?new Date(Date.UTC(p[1],b,p[3]||1,p[4]||0,p[5]||0,p[6]||0,O)):new Date(p[1],b,p[3]||1,p[4]||0,p[5]||0,p[6]||0,O)}}return new Date(t)}(e),this.init()},s.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},s.$utils=function(){return f},s.isValid=function(){return this.$d.toString()!==m},s.isSame=function(e,a){var t=o(e);return this.startOf(a)<=t&&t<=this.endOf(a)},s.isAfter=function(e,a){return o(e)<this.startOf(a)},s.isBefore=function(e,a){return this.endOf(a)<o(e)},s.$g=function(e,a,t){return f.u(e)?this[a]:this.set(t,e)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(e,a){var t=this,c=!!f.u(a)||a,p=f.p(e),b=function(Z,E){var J=f.w(t.$u?Date.UTC(t.$y,E,Z):new Date(t.$y,E,Z),t);return c?J:J.endOf(z)},O=function(Z,E){return f.w(t.toDate()[Z].apply(t.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(E)),t)},U=this.$W,A=this.$M,Y=this.$D,G="set"+(this.$u?"UTC":"");switch(p){case T:return c?b(1,0):b(31,11);case v:return c?b(1,A):b(0,A+1);case M:var F=this.$locale().weekStart||0,se=(U<F?U+7:U)-F;return b(c?Y-se:Y+(6-se),A);case z:case C:return O(G+"Hours",0);case x:return O(G+"Minutes",1);case I:return O(G+"Seconds",2);case D:return O(G+"Milliseconds",3);default:return this.clone()}},s.endOf=function(e){return this.startOf(e,!1)},s.$set=function(e,a){var t,c=f.p(e),p="set"+(this.$u?"UTC":""),b=(t={},t[z]=p+"Date",t[C]=p+"Date",t[v]=p+"Month",t[T]=p+"FullYear",t[x]=p+"Hours",t[I]=p+"Minutes",t[D]=p+"Seconds",t[_]=p+"Milliseconds",t)[c],O=c===z?this.$D+(a-this.$W):a;if(c===v||c===T){var U=this.clone().set(C,1);U.$d[b](O),U.init(),this.$d=U.set(C,Math.min(this.$D,U.daysInMonth())).$d}else b&&this.$d[b](O);return this.init(),this},s.set=function(e,a){return this.clone().$set(e,a)},s.get=function(e){return this[f.p(e)]()},s.add=function(e,a){var t,c=this;e=Number(e);var p=f.p(a),b=function(A){var Y=o(c);return f.w(Y.date(Y.date()+Math.round(A*e)),c)};if(p===v)return this.set(v,this.$M+e);if(p===T)return this.set(T,this.$y+e);if(p===z)return b(1);if(p===M)return b(7);var O=(t={},t[I]=g,t[x]=r,t[D]=u,t)[p]||1,U=this.$d.getTime()+e*O;return f.w(U,this)},s.subtract=function(e,a){return this.add(-1*e,a)},s.format=function(e){var a=this,t=this.$locale();if(!this.isValid())return t.invalidDate||m;var c=e||"YYYY-MM-DDTHH:mm:ssZ",p=f.z(this),b=this.$H,O=this.$m,U=this.$M,A=t.weekdays,Y=t.months,G=t.meridiem,F=function(E,J,ne,le){return E&&(E[J]||E(a,c))||ne[J].slice(0,le)},se=function(E){return f.s(b%12||12,E,"0")},Z=G||function(E,J,ne){var le=E<12?"AM":"PM";return ne?le.toLowerCase():le};return c.replace(h,function(E,J){return J||function(ne){switch(ne){case"YY":return String(a.$y).slice(-2);case"YYYY":return f.s(a.$y,4,"0");case"M":return U+1;case"MM":return f.s(U+1,2,"0");case"MMM":return F(t.monthsShort,U,Y,3);case"MMMM":return F(Y,U);case"D":return a.$D;case"DD":return f.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return F(t.weekdaysMin,a.$W,A,2);case"ddd":return F(t.weekdaysShort,a.$W,A,3);case"dddd":return A[a.$W];case"H":return String(b);case"HH":return f.s(b,2,"0");case"h":return se(1);case"hh":return se(2);case"a":return Z(b,O,!0);case"A":return Z(b,O,!1);case"m":return String(O);case"mm":return f.s(O,2,"0");case"s":return String(a.$s);case"ss":return f.s(a.$s,2,"0");case"SSS":return f.s(a.$ms,3,"0");case"Z":return p}return null}(E)||p.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(e,a,t){var c,p=this,b=f.p(a),O=o(e),U=(O.utcOffset()-this.utcOffset())*g,A=this-O,Y=function(){return f.m(p,O)};switch(b){case T:c=Y()/12;break;case v:c=Y();break;case y:c=Y()/3;break;case M:c=(A-U)/6048e5;break;case z:c=(A-U)/864e5;break;case x:c=A/r;break;case I:c=A/g;break;case D:c=A/u;break;default:c=A}return t?c:f.a(c)},s.daysInMonth=function(){return this.endOf(v).$D},s.$locale=function(){return B[this.$L]},s.locale=function(e,a){if(!e)return this.$L;var t=this.clone(),c=$(e,a,!0);return c&&(t.$L=c),t},s.clone=function(){return f.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},l}(),W=L.prototype;return o.prototype=W,[["$ms",_],["$s",D],["$m",I],["$H",x],["$W",z],["$M",v],["$y",T],["$D",C]].forEach(function(l){W[l[1]]=function(s){return this.$g(s,l[0],l[1])}}),o.extend=function(l,s){return l.$i||(l(s,L,o),l.$i=!0),o},o.locale=$,o.isDayjs=i,o.unix=function(l){return o(1e3*l)},o.en=B[Q],o.Ls=B,o.p={},o})}(me)),me.exports}var De=Se();const Ce=xe(De),ye=""+new URL("038932be4b191e1d2da90dd4c073ba53-D3l1dgcZ.jpeg",import.meta.url).href,$e=""+new URL("9c8b9a649ba9b48a457a74768823b153-DaIUkHh4.jpg",import.meta.url).href,je=20,qe={__name:"VirtualList",props:{items:Array,containerHeight:{type:Number,default:600},estimatedItemHeight:{type:Number,default:80}},setup(k,{expose:V}){const u=k,g=w(null),r=w([]),_=w(0),D=w(0),I=w(0);w(0);const x=w(0);function z(m,S){if(m){const h=m.offsetHeight;h&&r.value[S]!==h&&(r.value[S]=h,v())}}function M(m){let S=0;for(let h=0;h<m;h++)S+=r.value[h]||u.estimatedItemHeight;return S}function v(){x.value=u.items.reduce((m,S,h)=>m+(r.value[h]||u.estimatedItemHeight),0)}function y(){let m=0,S=0,h=u.items.length;for(let j=0;j<u.items.length;j++){const X=r.value[j]||u.estimatedItemHeight;if(m+X>I.value){S=j;break}m+=X}let d=0;for(h=S;h<u.items.length&&d<u.containerHeight;)d+=r.value[h]||u.estimatedItemHeight,h++;_.value=Math.max(0,S-je),D.value=Math.min(u.items.length,h+je)}const T=fe(()=>u.items.slice(_.value,D.value));function C(m){I.value=m.target.scrollTop,y()}return ce(()=>u.items,()=>{r.value=[],re(()=>{v(),y()})}),_e(()=>{v(),y()}),V({onScroll:C,updateVisibleRange:y}),(m,S)=>(H(),q("div",{class:"virtual-list",style:{height:"100%",overflowY:"auto",position:"relative"},onScroll:C,ref_key:"container",ref:g},[n("div",{style:ae({height:x.value+"px",position:"relative"})},[(H(!0),q(pe,null,he(T.value,(h,d)=>(H(),q("div",{key:h.id,ref_for:!0,ref:j=>z(j,_.value+d),style:ae({position:"absolute",width:"100%",top:M(_.value+d)+"px"})},[be(m.$slots,"default",{item:h},void 0)],4))),128))],4)],544))}},He=K(qe,[["__scopeId","data-v-94484858"]]),Me=""+new URL("Image_1083578313650448-B45b7cD2.jpg",import.meta.url).href,Te=""+new URL("Image_1083567666771598-HBN7voJc.jpg",import.meta.url).href,Oe=""+new URL("qq-D5TZtWP0.png",import.meta.url).href,Ue=""+new URL("huohua-DTAHrNL7.png",import.meta.url).href,Le=""+new URL("wx-Bg3sda2J.png",import.meta.url).href,Ae={class:"chat-container"},Ve=["id"],Ee={key:0,class:"avatar-wrap"},Ye={key:0,class:"icon"},Ne=["src"],Re={key:1,class:"icon"},Be=["src"],We={class:"message-content"},Pe={key:0,class:"quoteMessage"},Je={class:"quoteHeader"},Qe=["onClick"],Fe=["onClick"],Ze=["src"],Ke={key:1,class:"avatar-wrap"},Xe={__name:"ChatWindow",props:{virtualMessages:{type:Array,default:()=>[]},viewMode:{type:String,default:"self"}},emits:"jumpToMessageById",setup(k,{expose:V,emit:u}){const g=k;console.log(g.viewMode);const r=fe(()=>g.viewMode==="self"?Te:Me),_=fe(()=>g.viewMode==="self"?Me:Te);console.log(r.value,_.value);const D=w(null),I=()=>{D.value.updateVisibleRange()},x=T=>{if(T==="wx")return Le;if(T==="qq")return Oe;if(T==="huohua")return Ue},z=u,M=T=>{z("jumpToMessageById",T)},v=T=>(console.log({name:T}),new URL(Object.assign({"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg":ye,"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg":$e})[`/src/assets/images/${T}`],import.meta.url).href),y=T=>{z("previewImage",v(T))};return V({updateVisibleRange:I}),(T,C)=>(H(),q("div",Ae,[C[0]||(C[0]=n("div",{class:"chat-header"},[n("span",{class:"chat-title"},"i。"),n("span",null,"☰")],-1)),te(He,{items:g.virtualMessages,"item-size":80,class:"scroller",ref_key:"virtualListRef",ref:D},{default:we(({item:m})=>[n("div",{id:`message-${m.id}`,class:de(["message-row",k.viewMode==="self"?m.sender==="zic"?"right":"left":m.sender==="zic"?"left":"right"])},[k.viewMode==="self"&&m.sender==="xjj"||k.viewMode==="other"&&m.sender==="zic"?(H(),q("div",Ee,[n("div",{class:"avatar",style:ae({backgroundImage:`url(${r.value})`})},null,4)])):N("",!0),n("div",{class:de(["bubble-wrap",k.viewMode==="self"?m.sender==="zic"?"right":"left":m.sender==="zic"?"left":"right"])},[n("div",{class:de(["message-bubble",k.viewMode==="self"?m.sender==="zic"?"right":"left":m.sender==="zic"?"left":"right"])},[m.sender==="xjj"?(H(),q("div",Ye,[n("img",{src:x(m.platform),alt:""},null,8,Ne)])):N("",!0),m.sender==="zic"?(H(),q("div",Re,[n("img",{src:x(m.platform),alt:""},null,8,Be)])):N("",!0),n("div",We,[m.quoteMessage?(H(),q("div",Pe,[n("div",Je,[n("span",null,R(m.quoteMessage.sender),1),n("span",{onClick:S=>M(m.quoteMessage.id)},R("⤒"),9,Qe)]),n("div",null,R(m.quoteMessage.content||(m.quoteMessage.image?"图片":"")),1)])):N("",!0),n("span",null,R(m.content),1)]),m.image?(H(),q("div",{key:2,class:"message-image",onClick:S=>y(m.image)},[n("img",{src:v(m.image),alt:""},null,8,Ze)],8,Fe)):N("",!0)],2)],2),k.viewMode==="self"&&m.sender==="zic"||k.viewMode==="other"&&m.sender==="xjj"?(H(),q("div",Ke,[n("div",{class:"avatar",style:ae({backgroundImage:`url(${_.value})`})},null,4)])):N("",!0)],10,Ve)]),_:1},8,["items"]),C[1]||(C[1]=n("div",{class:"chat-input-bar"},[n("input",{class:"chat-input",type:"text",placeholder:"",disabled:""}),n("button",{class:"chat-send-btn",disabled:""},"发送")],-1))]))}},Ge=K(Xe,[["__scopeId","data-v-18d2a64f"]]),et={class:"image-selector"},tt={key:0,class:"modal"},st={class:"modal-content"},nt={class:"image-grid"},ot=["onClick"],at=["src","alt"],it={__name:"ImageSelector",emits:["imageSelected"],setup(k,{emit:V}){const u=w([]),g=w(!1),r=V,_=M=>{r("imageSelected",`${M}`),I()},D=()=>{g.value=!0,x()},I=()=>{g.value=!1},x=async()=>{const M=Object.assign({"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg":()=>ge(()=>import("./038932be4b191e1d2da90dd4c073ba53-C0dObslP.js"),[],import.meta.url),"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg":()=>ge(()=>import("./9c8b9a649ba9b48a457a74768823b153-D144U7zD.js"),[],import.meta.url)});console.log({imageModules:M}),u.value=Object.keys(M).map(v=>v.replace("/src/assets/images/","")),console.log(u)},z=M=>(console.log({name:M}),new URL(Object.assign({"/src/assets/images/038932be4b191e1d2da90dd4c073ba53.jpeg":ye,"/src/assets/images/9c8b9a649ba9b48a457a74768823b153.jpg":$e})[`/src/assets/images/${M}`],import.meta.url).href);return(M,v)=>(H(),q("div",et,[n("button",{onClick:D},"选择图片"),g.value?(H(),q("div",tt,[n("div",st,[n("span",{class:"close",onClick:I},"×"),n("div",nt,[(H(!0),q(pe,null,he(u.value,y=>(H(),q("div",{key:y,class:"image-item",onClick:T=>_(y)},[n("img",{src:z(y),alt:y},null,8,at)],8,ot))),128))])])])):N("",!0)]))}},lt=K(it,[["__scopeId","data-v-7494f0a8"]]),rt={class:"enter-message-container"},ut={class:"radio-group"},mt={class:"handleMessage"},ct={key:0},dt={class:"messagePreview"},ft={__name:"EnterMessage",props:{handleMessage:{type:Object,default:()=>{}},viewMode:{type:Object,default:""}},emits:["addMessage","cancelHandle"],setup(k,{emit:V}){const u=k,g=w("self"),r=w(""),_=w(""),D=w(""),I=w(""),x=w("qq"),z=V,M=()=>{if(!r.value.trim())return;const h=I.value,d={sender:g.value,message:r.value,event:_.value,platform:x.value,timestamp:u.handleMessage.message.timestamp||new Date(h).getTime(),image:y.value,handleMessage:u.handleMessage};console.log({chatRecord:d}),r.value="",_.value="",z("addMessage",d),S()},v=h=>{h.keyCode===13&&!h.shiftKey?(h.preventDefault(),M()):h.keyCode===9&&(h.preventDefault(),g.value=g.value==="self"?"other":"self")},y=w(null),T=h=>{console.log({image:h});const d=`${D.value.split("T")[0]} ${I.value}`;console.log(g);const j={sender:g.value,message:r.value,event:_.value,platform:x.value,timestamp:u.handleMessage.message.timestamp||new Date(d).getTime(),image:h,handleMessage:u.handleMessage};console.log({chatRecord:j}),z("addMessage",j),S()},C={edit:"编辑",quote:"引用"},m=h=>C[h],S=()=>{z("cancelHandle")};return ce(()=>u.handleMessage,h=>{if(console.log(h),!h.type)return;const d=h.message.sender;u.viewMode==="self"?d==="zic"?g.value="self":g.value="other":d==="zic"?g.value="other":g.value="self",h.type==="edit"&&(r.value=h.message.content)},{deep:!0}),(h,d)=>(H(),q("div",rt,[n("div",ut,[n("div",null,[n("label",null,[P(n("input",{type:"radio",name:"sender",value:"self","onUpdate:modelValue":d[0]||(d[0]=j=>g.value=j)},null,512),[[oe,g.value]]),d[8]||(d[8]=ee(" 我方 "))]),n("label",null,[P(n("input",{type:"radio",name:"sender",value:"other","onUpdate:modelValue":d[1]||(d[1]=j=>g.value=j)},null,512),[[oe,g.value]]),d[9]||(d[9]=ee(" 对方 "))])]),n("div",null,[n("label",null,[P(n("input",{type:"radio",name:"platform",value:"qq","onUpdate:modelValue":d[2]||(d[2]=j=>x.value=j)},null,512),[[oe,x.value]]),d[10]||(d[10]=ee(" QQ "))]),n("label",null,[P(n("input",{type:"radio",name:"platform",value:"wx","onUpdate:modelValue":d[3]||(d[3]=j=>x.value=j)},null,512),[[oe,x.value]]),d[11]||(d[11]=ee(" 微信 "))]),n("label",null,[P(n("input",{type:"radio",name:"platform",value:"huohua","onUpdate:modelValue":d[4]||(d[4]=j=>x.value=j)},null,512),[[oe,x.value]]),d[12]||(d[12]=ee(" 火花 "))])]),P(n("input",{style:{outline:"0"},type:"text","onUpdate:modelValue":d[5]||(d[5]=j=>_.value=j),placeholder:"请输入事件..."},null,512),[[ue,_.value]]),P(n("input",{type:"text","onUpdate:modelValue":d[6]||(d[6]=j=>I.value=j),style:{width:"140px",outline:"0","margin-left":"10px"},placeholder:"时间"},null,512),[[ue,I.value]]),te(lt,{onImageSelected:T})]),n("div",mt,[n("span",{class:"cancelBtn",onClick:S},R("✖"),1),k.handleMessage.type&&k.handleMessage.message?(H(),q("span",ct,R(m(k.handleMessage.type))+" : ",1)):N("",!0),n("span",dt,R(k.handleMessage.message.content||(k.handleMessage.message.image?"图片":"")),1)]),P(n("textarea",{"onUpdate:modelValue":d[7]||(d[7]=j=>r.value=j),placeholder:"请输入消息...",onKeydown:v},null,544),[[ue,r.value]]),n("button",{onClick:M},"发送")]))}},pt=K(ft,[["__scopeId","data-v-e664223f"]]),ht={key:0,class:"image-preview"},gt={class:"preview-content"},vt=["src"],jt={__name:"ImagePreview",props:{imageUrl:String},emits:["close"],setup(k,{emit:V}){w(!1);const u=V,g=()=>{u("close")};return(r,_)=>k.imageUrl?(H(),q("div",ht,[n("div",{class:"overlay",onClick:g}),n("div",gt,[n("button",{style:{outline:"0","margin-bottom":"20px"},onClick:g},R("✖"),1),n("img",{src:k.imageUrl,alt:"Preview"},null,8,vt)])])):N("",!0)}},Mt=K(jt,[["__scopeId","data-v-76550259"]]),Tt={__name:"ContextMenu",emits:["editMessage","deleteMessage"],setup(k,{emit:V}){const u=w({isShow:!1,position:{x:0,y:0},messageId:0}),g=(M,v)=>{M.preventDefault();const y=M.target.closest(".chat");console.log(y.offsetTop);const T={x:M.clientX-y.offsetLeft,y:M.clientY-y.offsetTop};u.value={isShow:!0,position:T,messageId:v}},r=()=>{u.value={isShow:!1,position:{x:0,y:0},messageId:0}},_=V,D=M=>{switch(M){case"edit":I();break;case"delete":x();break;case"quote":z()}r()},I=()=>{_("editMessage",u.messageId)},x=()=>{_("deleteMessage",u.messageId)},z=()=>{_("quoteMessage",u.messageId)};return document.addEventListener("contextmenu",M=>{const v=M.target.closest(".message-row");if(v){const y=v.closest(".message-row").id.split("-")[1];u.messageId=y,g(M,y)}}),document.addEventListener("click",M=>{M.target.closest(".context-menu")||r()}),(M,v)=>{var y,T;return u.value.isShow?(H(),q("div",{key:0,class:"context-menu",style:ae({top:`${(y=u.value.position)==null?void 0:y.y}px`,left:`${(T=u.value.position)==null?void 0:T.x}px`})},[n("ul",null,[n("li",{onClick:v[0]||(v[0]=C=>D("edit"))},"编辑"),n("li",{onClick:v[1]||(v[1]=C=>D("quote"))},"引用"),n("li",{onClick:v[2]||(v[2]=C=>D("delete"))},"删除")])],4)):N("",!0)}}},yt=K(Tt,[["__scopeId","data-v-3fa06248"]]),$t=JSON.parse('[{"id":1,"content":"你头像更可爱1","timestamp":1742396160000,"sender":"xjj","event":"hello","platform":"huohua","image":null,"offsetTop":"0"},{"id":2,"content":"伊地知虹夏，孤独摇滚里的，你看过嘛","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"56"},{"id":3,"content":"没有诶","timestamp":1742396160000,"sender":"xjj","event":"","platform":"qq","image":null,"offsetTop":"136"},{"id":4,"content":"今天刚玩 我试试这个","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":192},{"id":5,"content":"哈哈哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":248},{"id":6,"content":"Q：咳嗽不小心把口香糖吐到前面人头上...\\nA：告诉TA并道歉","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":304},{"id":7,"content":"A：告诉TA并道歉","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":408},{"id":8,"content":"Q：相信一见钟情还是日久生情？\\nA：日久生情","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":464},{"id":9,"content":"Q：宁愿被拒绝也要表达爱意，还是永远藏在心里不表白？\\nA：宁愿被拒绝也要表达爱意","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":544},{"id":10,"content":"A：日久生情","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":648},{"id":11,"content":"这个好纠结","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":704},{"id":12,"content":"A：宁愿被拒绝也要表达爱意","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":760},{"id":13,"content":"Q：失眠一星期还是一星期睡不醒？\\nA：一星期睡不醒","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":816},{"id":14,"content":"哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":896},{"id":15,"content":"A：一星期睡不醒","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":952},{"id":16,"content":"哈哈哈哈哈哈哈哈哈哈牛啊","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1008},{"id":17,"content":"我也是，但最后，都会忍不住","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1064},{"id":18,"content":"而且很容易触发人生三大错觉之一，她喜欢我","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1120},{"id":19,"content":"哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1200},{"id":20,"content":"也是哦","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1256},{"id":21,"content":"而且说了说不定就有结局呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1312},{"id":22,"content":"😭","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1368},{"id":23,"content":"都是错觉","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1424},{"id":24,"content":"说了一定有结局，指朋友也做不了","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1480},{"id":25,"content":"看来你被伤过","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1536},{"id":26,"content":"很早了，过去了，我现在强得可怕","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1592},{"id":27,"content":"哇","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1648},{"id":28,"content":"哈哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1704},{"id":29,"content":"多强","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1760},{"id":30,"content":"现在见到谁都不会喜欢了","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1816},{"id":31,"content":"😇","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":1872},{"id":32,"content":"哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1928},{"id":33,"content":"那的确挺强","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":1984},{"id":34,"content":"那你为什么下这个软件","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2040},{"id":35,"content":"今天 听朋友说的","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2096},{"id":36,"content":"好吧嘿嘿","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2152},{"id":37,"content":"","timestamp":1742396160000,"sender":"zic","event":"","platform":"qq","image":"038932be4b191e1d2da90dd4c073ba53.jpeg","offsetTop":2208},{"id":38,"content":"你有点可爱，今年多大啦","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2506},{"id":39,"content":"可以问吗","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":2562},{"id":40,"content":"21","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2618},{"id":41,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":2674},{"id":42,"content":"","timestamp":1742396160000,"sender":"xjj","event":"","platform":"qq","image":"038932be4b191e1d2da90dd4c073ba53.jpeg","offsetTop":2730},{"id":43,"content":"24","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3268},{"id":44,"content":"比你大点点","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3324},{"id":45,"content":"对嘿嘿","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3380},{"id":46,"content":"大三？","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3436},{"id":47,"content":"对!","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3492},{"id":48,"content":"真好啊，我已经是社畜了😇","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3548},{"id":49,"content":"哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3604},{"id":50,"content":"社畜也挺好啊","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3660},{"id":51,"content":"你在哪上学呢","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3716},{"id":52,"content":"山东","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3772},{"id":53,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3828},{"id":54,"content":"我山西运城的，在西安上班","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3884},{"id":55,"content":"之前在太原读的书","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":3940},{"id":56,"content":"哦哦","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":3996},{"id":57,"content":"明天有课吗","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4052},{"id":58,"content":"早八","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4108},{"id":59,"content":"🤣","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4164},{"id":60,"content":"平时玩什么","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4220},{"id":61,"content":"玩王者","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4276},{"id":62,"content":"你呢","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4332},{"id":63,"content":"周末和朋友玩英雄联盟，周内自己找点单机玩","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4388},{"id":64,"content":"哈哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4468},{"id":65,"content":"你不会是j人吧","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4524},{"id":66,"content":"jp的j哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4580},{"id":67,"content":"j人是什么，第一次听说","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4636},{"id":68,"content":"emmmm 查了下 主观上j人 客观上不是","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4692},{"id":69,"content":"哈哈哈哈哈哈哈哈","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4772},{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4828},{"id":71,"content":"就是对自己的一天很有规划","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4908},{"id":72,"content":"那你是p人","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":4964,"quoteMessage":{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":"4588"}},{"id":73,"content":"但现实遇到问题要解决的时候会计划好","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5092},{"id":74,"content":"那感觉还是p人","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5172},{"id":75,"content":"因为计划好了也会拖延","timestamp":1742396160000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5284,"quoteMessage":{"id":70,"content":"因为拖延症会让一次计划不能顺利实施","timestamp":1742396160000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":4588}},{"id":76,"content":"p人的p是procrastination的p","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5784},{"id":77,"content":"这个就是我的盲区了哈哈哈哈哈哈哈哈哈哈","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5840},{"id":78,"content":"拖延的意思","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":5920},{"id":79,"content":"哦哦","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":5976},{"id":80,"content":"我反正也是p人","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":6032},{"id":81,"content":"mbti以前不都是说i人和e人的吗","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6088},{"id":82,"content":"哈哈哈哈哈哈哈哈","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":6144},{"id":83,"content":"那你是i还是e","timestamp":1742397360000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":6200},{"id":84,"content":"网上e，现实i","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6256},{"id":85,"content":"火花炮弹X1","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6312},{"id":86,"content":"Q:相信人性本善还是人性本恶\\nA：人性本恶","timestamp":1742397360000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6368},{"id":87,"content":"A:人性本恶","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":6664},{"id":88,"content":"这个是我思考了好久的答案","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":6720},{"id":89,"content":"到目前为止完全默契诶","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":6776},{"id":90,"content":"","timestamp":1742397000000,"sender":"zic","event":"","platform":"qq","image":"9c8b9a649ba9b48a457a74768823b153.jpg","offsetTop":6832},{"id":91,"content":"右边还真是我","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":7431},{"id":92,"content":"我左边哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742397000000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7487},{"id":93,"content":"原来是这样 8个字母代表四组","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":7543},{"id":94,"content":"你晚上几点睡觉呢","timestamp":1742397000000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":7599},{"id":95,"content":"我不知道嘿嘿","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7655},{"id":96,"content":"困了就睡","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7711},{"id":97,"content":"你呢","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7767},{"id":98,"content":"你没测过mbti吗","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7823},{"id":99,"content":"测过，不过以前只听说i/e人，所以只记得第一位是i了","timestamp":1742398740000,"sender":"zic","event":"","platform":"huohua","image":null,"offsetTop":7879},{"id":100,"content":"哈哈哈哈哈哈哈哈哈哈哈","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":7959},{"id":101,"content":"我猜你是","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":8015},{"id":102,"content":"infp","timestamp":1742398740000,"sender":"xjj","event":"","platform":"huohua","image":null,"offsetTop":8015}]'),xt={class:"chat"},_t={key:0},bt={class:"meaasgeManager"},wt={class:"search-results"},kt=["onClick"],It={class:"result-content"},zt={__name:"ChatView",setup(k){const V=w("edit"),u=w("self"),g=w(null),r=w([]);r.value=[...$t];const _=i=>Ce(i).format("YYYY-DD-MM HH:mm"),D=i=>{let $={self:"zic",other:"xjj"};return u.value==="self"||($={self:"xjj",other:"zic"}),$[i]},I=i=>{var L;const $=document.querySelector(".virtual-list").children[0],o={id:r.value.length+1,content:i.message,timestamp:i.timestamp,sender:D(i.sender),event:i.event,platform:i.platform,image:i.image,offsetTop:$.style.height.replace("px","")};if((L=i.handleMessage)!=null&&L.type){if(console.log(i.handleMessage.type),i.handleMessage.type==="edit"){const W=r.value.findIndex(l=>l.id===i.handleMessage.message.id);o.id=i.handleMessage.message.id,o.offsetTop=i.handleMessage.message.offsetTop,i.handleMessage.message.quoteMessage&&(o.quoteMessage=i.handleMessage.message.quoteMessage),r.value.splice(W,1,o)}i.handleMessage.type==="quote"&&(o.quoteMessage=i.handleMessage.message,r.value.push(o))}else r.value.push(o);if(i.handleMessage.type==="edit"){const W=document.getElementById(`message-${o.id}`),l=W.offsetHeight,s=o.id;re(()=>{const a=W.offsetHeight-l;console.log({diffHeight:a}),console.log(i.handleMessage.message.id);const t=r.value.findIndex(c=>c.id==s);console.log({i:t}),r.value.forEach((c,p)=>{p>t&&(console.log(t),c.offsetTop=+c.offsetTop+a)})})}console.log(r);const f=document.querySelector(".scroller");f.scrollTop=f.scrollHeight},x=()=>{const i=document.createElement("input");i.type="file",i.accept="application/json",i.onchange=async $=>{const o=$.target.files[0];if(o){const f=await o.text(),L=JSON.parse(f);console.log(Ie(L)),r.value=[...L]}},i.click()},z=()=>{const i=r.value;console.log(r.value);const $=JSON.stringify(i),o=new Blob([$],{type:"application/json"}),f=URL.createObjectURL(o),L=document.createElement("a");L.href=f,L.download="chatlog.json",L.click(),URL.revokeObjectURL(f)},M=()=>{re(()=>{console.log("触发");const i=document.querySelector(".scroller");i&&(console.log(g.value),g.value.updateVisibleRange(),setTimeout(()=>{i.scrollTop=i.scrollHeight},100))})};ce(r,()=>{console.log("触发监听"),M()},{deep:!0});const v=document.querySelector(".scroller");v&&v.addEventListener("scroll",()=>{console.log("Scrolled! Recalculate visible messages.")});const y=w(""),T=w([]),C=()=>{if(y.value===""){T.value=[];return}const i=y.value.split(" ").filter(o=>o.trim()!==""),$=r.value.filter(o=>i.every(f=>new RegExp(f,"i").test(o.content)));T.value=$};ce(y,C);const m=i=>{const{offsetTop:$}=r.value.find(f=>f.id==i),o=document.querySelector(".scroller");o&&o.scrollTo({top:$,behavior:"smooth"})},S=w(null),h=i=>{S.value=i},d=()=>{S.value=null},j=ke({type:"",message:{}}),X=i=>{console.log(i),console.log(r.value);const $=r.value.find(o=>o.id==i);j.message=$,j.type="edit"},Q=i=>{const $=r.value.findIndex(L=>L.id==i),o=document.getElementById(`message-${i}`),f=o.offsetHeight;r.value.splice($,1),re(()=>{const W=o.offsetHeight-f;r.value.forEach((l,s)=>{s>$&&(console.log($),l.offsetTop=+l.offsetTop+W)})})},B=i=>{const $=r.value.find(o=>o.id==i);j.message=$,j.type="quote"},ie=()=>{j.type="",j.message={}};return(i,$)=>(H(),q("div",xt,[te(Ge,{virtualMessages:r.value,onPreviewImage:h,viewMode:u.value,ref_key:"chatWindowRef",ref:g,onJumpToMessageById:m},null,8,["virtualMessages","viewMode"]),V.value==="edit"?(H(),q("div",_t,[n("div",bt,[te(pt,{viewMode:u.value,onAddMessage:I,handleMessage:j,onCancelHandle:ie},null,8,["viewMode","handleMessage"]),n("button",{onClick:x},"导入聊天记录"),n("button",{onClick:z},"导出聊天记录"),n("button",{onClick:$[0]||($[0]=o=>u.value=u.value==="self"?"other":"self")},"切换视角")]),P(n("input",{class:"chat-search",type:"text",placeholder:"搜索聊天记录","onUpdate:modelValue":$[1]||($[1]=o=>y.value=o),onInput:C},null,544),[[ue,y.value]]),n("div",wt,[(H(!0),q(pe,null,he(T.value,o=>(H(),q("div",{key:o.id,class:"search-result-item",onClick:f=>m(o.id)},[n("div",It,[n("div",null,[n("span",null,R(o.sender),1),n("span",null,R(_(o.timestamp)),1)]),$[2]||($[2]=ee("edit ")),n("span",null,R(o.content),1)])],8,kt))),128))]),te(yt,{messageId:i.messageId,onEditMessage:X,onDeleteMessage:Q,onQuoteMessage:B},null,8,["messageId"])])):N("",!0),te(Mt,{imageUrl:S.value,onClose:d},null,8,["imageUrl"])]))}},Dt=K(zt,[["__scopeId","data-v-65fc588e"]]);export{Dt as default};
